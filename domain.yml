version: "3.1"

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true

intents:
  - saludo
  - despedida
  - agradecimiento
  - afirmacion
  - negacion
  - ayuda
  - enviar_carnet       # cuando el usuario env√≠e la foto del carnet
  - describir_problema  # cuando describa el problema despu√©s de elegir categor√≠a
  - reportar_incidente  # lo usaremos para activar el flujo de incidente
  - fuera_de_alcance

entities: []

slots:
  authenticated:
    type: bool
    initial_value: false
    influence_conversation: true
    mappings:
      - type: custom   # lo setearemos desde una acci√≥n personalizada

  employee_code:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  employee_name:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  branch_number:
    type: text
    influence_conversation: true
    mappings:
      - type: custom

  categoria:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: incidente_form
            requested_slot: categoria

  subcategoria:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: incidente_form
            requested_slot: subcategoria

  descripcion:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        conditions:
          - active_loop: incidente_form
            requested_slot: descripcion

  ticket_id:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

forms:
  incidente_form:
    required_slots:
      - categoria
      - subcategoria
      - descripcion

responses:

  # --- Flujo de autenticaci√≥n por carnet ---
  utter_pedir_carnet:
    - text: "Hola üëã, soy el asistente de Soporte T√©cnico. Para continuar necesito validar tu identidad. Por favor, env√≠ame una foto de tu carnet corporativo."

  utter_autenticacion_fallida:
    - text: "No he podido validar tus datos con el carnet enviado. Por favor, verifica la imagen o contacta a soporte por los canales habituales."

  utter_bienvenida_autenticado:
    - text: "Hola {employee_name} (c√≥digo {employee_code}) de la sucursal {branch_number} üëã. Selecciona la categor√≠a que mejor describe tu problema."

  # --- Categor√≠as y subcategor√≠as ---
  utter_ask_categoria:
    - text: "Selecciona la categor√≠a de tu problema:"
      buttons:
        - title: "Monitor / Pantalla"
          payload: "monitor"
        - title: "Case / CPU / Computadora"
          payload: "computadora"
        - title: "Digitalizadora / Scanner - Financieras"
          payload: "scannersfin"
        - title: "Digitalizadora / Scanner - Cajas"
          payload: "scannercaja"
        - title: "Impresora T√©rmica / Bixolon"
          payload: "impresora_termica"
        - title: "Impresora L√°ser / Lexmark"
          payload: "impresora_laser"
        - title: "Perif√©ricos / Dispositivos"
          payload: "periferico"
        - title: "Internet / Red"
          payload: "internet"
        - title: "Sistema / Software"
          payload: "software"
        - title: "Otros"
          payload: "otro"

  # Ejemplo para subcategor√≠as de perif√©ricos (luego podemos a√±adir m√°s por categor√≠a)
  utter_ask_subcategoria:
    - text: "¬øQu√© dispositivo est√° presentando el problema?"
      buttons:
        - title: "Teclado"
          payload: "teclado"
        - title: "Mouse"
          payload: "mouse"
        - title: "Lector de huellas"
          payload: "finger"
        - title: "Lector de DPI"
          payload: "lector_dpi"
        - title: "C√°mara web"
          payload: "camara_web"
        - title: "Pad de firmas (Topaz)"
          payload: "topaz"
        - title: "Pin pad num√©rico"
          payload: "pinpad"
        - title: "No aplica / Otro"
          payload: "no_aplica"

  # --- Descripci√≥n del problema ---
  utter_ask_descripcion:
    - text: "Descr√≠beme brevemente qu√© est√° ocurriendo, por favor."

  # --- Preguntar si se solucion√≥ ---
  utter_preguntar_si_se_soluciono:
    - text: "¬øEl problema se solucion√≥ con los pasos anteriores?"
      buttons:
        - title: "S√≠, ya se solucion√≥ ‚úÖ"
          payload: "/afirmacion"
        - title: "No, sigue el problema ‚ùå"
          payload: "/negacion"

  utter_despedida_incidente_resuelto:
    - text: "Perfecto, me alegra que se haya solucionado üôå. Si necesitas algo m√°s, vuelve a escribirme."

  utter_ticket_creado:
    - text: "He generado el ticket {ticket_id} con la informaci√≥n de tu incidente. Un t√©cnico dar√° seguimiento lo antes posible."

  # --- Respuestas generales que ya usabas ---
  utter_saludo:
    - text: "Hola üëã, soy el asistente de Soporte T√©cnico."

  utter_despedida:
    - text: "Gracias por contactarnos. ¬°Que tengas buen d√≠a! üëã"

  utter_agradecimiento:
    - text: "Con gusto, para eso estoy üòä"

  utter_ayuda:
    - text: "Puedo ayudarte a reportar problemas de software y hardware en sucursales. Por ejemplo: POS, impresoras, internet, equipos de c√≥mputo. Cu√©ntame qu√© est√° pasando."

  utter_fuera_de_alcance:
    - text: "Por ahora solo puedo ayudarte con temas de soporte t√©cnico de sucursales (equipos, impresoras, internet, sistemas). ¬øQu√© problema tienes all√≠?"

  utter_ofrecer_otro_incidente:
    - text: "¬øDeseas consultar o reportar otro problema?"
      buttons:
        - title: "S√≠, otro problema"
          payload: "/afirmacion"
        - title: "No, gracias"
          payload: "/negacion"

  utter_despedida_final:
    - text: "¬°Perfecto! Si necesitas algo m√°s, estar√© aqu√≠ para ayudarte. üëã"

actions:
  - action_hello_world
  - action_confirmar_reporte
  # M√°s adelante agregaremos:
  - action_verificar_identidad
  # - action_proponer_solucion_incidente
  # - action_crear_ticket
  - validate_incidente_form
  - action_reset_incidente
  - action_start_nuevo_incidente
